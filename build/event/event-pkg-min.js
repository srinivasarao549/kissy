/*
Copyright 2010, KISSY UI Library v1.1.7dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("event",function(d,l){function j(a,b,e,g,k){if(d.isString(b))b=d.query(b);if(d.isArray(b)){d.each(b,function(m){p[a](m,e,g,k)});return true}if((e=d.trim(e))&&e.indexOf(y)>0){d.each(e.split(y),function(m){p[a](b,m,g,k)});return true}if(b.getDOMNodes){for(var i=0;i<b.length;i++)p[a](b.item(i),e,g,k);return true}}function h(a,b){n(a)&&f.data(a,w,b)}function n(a){return a&&a.nodeType!==3&&a.nodeType!==8}var c=document,f=d.DOM,s=c.addEventListener?function(a,b,e,g){a.addEventListener&&a.addEventListener(b,
e,!!g)}:function(a,b,e){a.attachEvent&&a.attachEvent("on"+b,e)},t=c.removeEventListener?function(a,b,e,g){a.removeEventListener&&a.removeEventListener(b,e,!!g)}:function(a,b,e){a.detachEvent&&a.detachEvent("on"+b,e)},w="ksEventTargetId",y=" ",z=d.now(),x={},p={EVENT_GUID:w,special:{},add:function(a,b,e,g){if(!j("add",a,b,e,g)){var k=n(a)?f.data(a,w):-1,i,m,q,r,v;if(!(k===-1||!b||!d.isFunction(e))){if(!k){h(a,k=z++);x[k]={target:a,events:{}}}m=x[k].events;if(!m[b]){i=((k=!a.isCustomEventTarget)||a._supportSpecialEvent)&&
p.special[b]||{};q=function(o,u){if(!o||!o.fixed)o=new d.EventObject(a,o,b);d.isPlainObject(u)&&d.mix(o,u);i.setup&&i.setup(o);return(i.handle||p._handle)(a,o,m[b].listeners)};m[b]={handle:q,listeners:[]};r=i.fix||b;v=i.capture;if(k)s(a,r,q,v);else a._addEvent&&a._addEvent(r,q,v)}m[b].listeners.push({fn:e,scope:g||a})}}},remove:function(a,b,e,g){if(!j("remove",a,b,e,g)){var k=n(a)?f.data(a,w):-1,i,m,q,r,v,o,u;if(k!==-1)if(k&&(i=x[k]))if(i.target===a){g=g||a;i=i.events||{};if(m=i[b]){q=m.listeners;
o=q.length;if(d.isFunction(e)&&o){v=r=0;for(u=[];r<o;++r)if(e!==q[r].fn||g!==q[r].scope)u[v++]=q[r];m.listeners=u;o=u.length}if(e===l||o===0){if(a.isCustomEventTarget)a._removeEvent&&a._removeEvent(b,m.handle);else{e=p.special[b]||{};t(a,e.fix||b,m.handle)}delete i[b]}}if(b===l||d.isEmptyObject(i)){for(b in i)p.remove(a,b);delete x[k];f.removeData(a,w)}}}},_handle:function(a,b,e){e=e.slice(0);var g;a=0;for(var k=e.length;a<k;++a){g=e[a];g=g.fn.call(g.scope,b);if(g!==l){b.result=g;g===false&&b.halt()}if(b.isImmediatePropagationStopped)break}return g},
_getCache:function(a){return x[a]},_simpleAdd:s,_simpleRemove:t};p.on=p.add;d.Event=p});
KISSY.add("event-object",function(d,l){function j(c,f,s){this.currentTarget=c;this.originalEvent=f||{};if(f){this.type=f.type;this._fix()}else{this.type=s;this.target=c}if(c.isCustomEventTarget)if(d.DOM._isKSNode(c))this.target=new d.Node(this.target);this.currentTarget=c;this.fixed=true}var h=document,n="altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" ");d.augment(j,
{_fix:function(){var c=this.originalEvent,f=n.length,s,t=this.currentTarget;for(t=t.nodeType===9?t:t.ownerDocument||h;f;){s=n[--f];this[s]=c[s]}if(!this.target)this.target=this.srcElement||h;if(this.target.nodeType===3)this.target=this.target.parentNode;if(!this.relatedTarget&&this.fromElement)this.relatedTarget=this.fromElement===this.target?this.toElement:this.fromElement;if(this.pageX===l&&this.clientX!==l){c=t.documentElement;f=t.body;this.pageX=this.clientX+(c&&c.scrollLeft||f&&f.scrollLeft||
0)-(c&&c.clientLeft||f&&f.clientLeft||0);this.pageY=this.clientY+(c&&c.scrollTop||f&&f.scrollTop||0)-(c&&c.clientTop||f&&f.clientTop||0)}if(this.which===l)this.which=this.charCode!==l?this.charCode:this.keyCode;if(this.metaKey===l)this.metaKey=this.ctrlKey;if(!this.which&&this.button!==l)this.which=this.button&1?1:this.button&2?3:this.button&4?2:0},preventDefault:function(){var c=this.originalEvent;if(c.preventDefault)c.preventDefault();else c.returnValue=false;this.isDefaultPrevented=true},stopPropagation:function(){var c=
this.originalEvent;if(c.stopPropagation)c.stopPropagation();else c.cancelBubble=true;this.isPropagationStopped=true},stopImmediatePropagation:function(){var c=this.originalEvent;c.stopImmediatePropagation?c.stopImmediatePropagation():this.stopPropagation();this.isImmediatePropagationStopped=true},halt:function(c){c?this.stopImmediatePropagation():this.stopPropagation();this.preventDefault()}});d.EventObject=j});
KISSY.add("event-target",function(d,l){var j=d.Event;d.EventTarget={isCustomEventTarget:true,fire:function(h,n){var c=d.DOM.data(this,j.EVENT_GUID)||-1;if((c=((j._getCache(c)||{}).events||{})[h])&&d.isFunction(c.handle))return c.handle(l,n);return this},on:function(h,n,c){j.add(this,h,n,c);return this},detach:function(h,n,c){j.remove(this,h,n,c);return this}}});
KISSY.add("event-mouseenter",function(d){var l=d.Event;d.UA.ie||d.each([{name:"mouseenter",fix:"mouseover"},{name:"mouseleave",fix:"mouseout"}],function(j){l.special[j.name]={fix:j.fix,setup:function(h){h.type=j.name},handle:function(h,n,c){if(d.DOM._isKSNode(h))h=h[0];var f=n.relatedTarget;try{for(;f&&f!==h;)f=f.parentNode;f!==h&&l._handle(h,n,c)}catch(s){}}}})});
KISSY.add("event-focusin",function(d){var l=d.Event;document.addEventListener&&d.each([{name:"focusin",fix:"focus"},{name:"focusout",fix:"blur"}],function(j){l.special[j.name]={fix:j.fix,capture:true,setup:function(h){h.type=j.name}}})});
